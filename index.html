<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>最強777 v6.0</title>

<style>
:root{
  --bg:#020617;--card:#0f172a;--line:#1e293b;
  --text:#e5e7eb;--muted:#94a3b8;
  --hot:#ef4444;--warm:#facc15;--cold:#38bdf8;
  --star3:#22c55e;--star2:#facc15;--star1:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif}
.wrap{max-width:430px;margin:0 auto;padding:16px}
h1{margin:4px 0;font-size:26px}
.sub{font-size:13px;color:var(--muted);margin-bottom:12px}

.card{background:var(--card);border:1px solid var(--line);
border-radius:18px;padding:14px;margin-bottom:14px}

.boxrow{display:grid;gap:8px}
.boxrow.l6{grid-template-columns:repeat(6,1fr)}
.boxrow.mini{grid-template-columns:repeat(5,1fr)}
.nbox{height:48px;border-radius:12px;border:1px solid var(--line);
background:#020617;color:var(--text);text-align:center;font-size:18px}

.btnrow{display:flex;gap:10px;margin-top:10px}
button{flex:1;height:44px;border-radius:14px;border:1px solid var(--line);
background:#020617;color:var(--text);font-weight:700}

.pool{text-align:center;font-size:20px;font-weight:800}
.meta{text-align:center;font-size:12px;color:var(--muted)}

.ticket{border:1px solid var(--line);border-radius:14px;
padding:10px;margin-top:8px}
.stars{text-align:center;font-size:20px;font-weight:900}
.star3{color:var(--star3)}
.star2{color:var(--star2)}
.star1{color:var(--star1)}
.nums{text-align:center;font-size:18px;font-weight:700;letter-spacing:2px}
.tags{text-align:center;font-size:11px;color:var(--muted)}

textarea{width:100%;min-height:60px;background:#020617;
border:1px solid var(--line);color:var(--text);
border-radius:12px;padding:8px}

/* ===== ヒートマップ ===== */
.heatmap{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;margin-top:10px
}
.hm{
  position:relative;
  text-align:center;padding:6px 0;
  border-radius:10px;font-size:12px;font-weight:800;
  border:1px solid var(--line)
}
.hm.hot{background:rgba(239,68,68,.25);color:var(--hot)}
.hm.warm{background:rgba(250,204,21,.25);color:var(--warm)}
.hm.cold{background:rgba(56,189,248,.25);color:var(--cold)}
.hm.sel{outline:2px solid #e5e7eb}
.trend{
  position:absolute;right:6px;top:2px;
  font-size:12px;font-weight:900;color:#e5e7eb
}
</style>
</head>

<body>
<div class="wrap">

<h1>最強777</h1>
<div class="sub">
一致1固定｜連番必須｜精密引っ張り｜ヒートマップ×トレンド
</div>

<div class="card">
<h3>ロト6（前回）</h3>
<div class="boxrow l6" id="l6">
<input class="nbox"><input class="nbox"><input class="nbox">
<input class="nbox"><input class="nbox"><input class="nbox">
</div>

<h3 style="margin-top:8px">ミニロト（前回）</h3>
<div class="boxrow mini" id="mini">
<input class="nbox"><input class="nbox"><input class="nbox">
<input class="nbox"><input class="nbox">
</div>

<h3 style="margin-top:8px">過去履歴（貼り付け）</h3>
<textarea id="history" placeholder="各回を改行で貼り付け"></textarea>

<div class="btnrow">
<button onclick="calc()">予想生成</button>
<button onclick="showStrong()">★★★のみ</button>
</div>
</div>

<div class="card">
<h3>数字別ヒートマップ</h3>
<div class="heatmap" id="heatmap"></div>
<div class="meta">枠線＝母集団 / ↑↓＝直近トレンド</div>
</div>

<div class="card">
<h3>勝負日判定</h3>
<div class="pool" id="battle">—</div>
</div>

<div class="card">
<h3>ロト6 予想</h3>
<div class="pool" id="pool6">—</div>
<div class="meta" id="meta6">—</div>
<div id="out6"></div>
</div>

<div class="card">
<h3>ミニロト 予想</h3>
<div class="pool" id="poolM">—</div>
<div class="meta" id="metaM">—</div>
<div id="outM"></div>
</div>

</div>

<script>
/* ===== 共通 ===== */
function read(id,c,max){
 const v=[...document.querySelectorAll("#"+id+" .nbox")]
 .map(x=>x.value).filter(x=>x!=="").map(Number);
 if(v.length!==c||new Set(v).size!==v.length) return null;
 if(v.some(n=>n<1||n>max)) return null;
 return v.sort((a,b)=>a-b);
}
function hasSeq(a){
 for(let i=0;i<a.length-1;i++) if(a[i+1]-a[i]===1) return true;
 return false;
}
function parseHistory(){
 return document.getElementById("history").value
 .split("\n").map(r=>r.trim().split(/\s+/).map(Number))
 .filter(r=>r.length>0);
}

/* ===== トレンド ===== */
function trendOf(n,history){
 if(history.length<4) return "→";
 const half=Math.floor(history.length/2);
 const a=history.slice(0,half).filter(h=>h.includes(n)).length;
 const b=history.slice(half).filter(h=>h.includes(n)).length;
 if(b>a) return "↑";
 if(b<a) return "↓";
 return "→";
}

/* ===== ヒートマップ ===== */
function buildHeatmap(history,max,selected){
 const map=document.getElementById("heatmap");
 map.innerHTML="";
 for(let n=1;n<=max;n++){
  let gap=0,freq=0;
  for(let h of history){if(h.includes(n))break;gap++}
  history.forEach(h=>{if(h.includes(n))freq++});
  let cls="warm";
  if(gap>=5) cls="hot";
  else if(freq>=3) cls="cold";

  const d=document.createElement("div");
  d.className="hm "+cls+(selected.includes(n)?" sel":"");
  d.innerHTML=`${n}<span class="trend">${trendOf(n,history)}</span>`;
  map.appendChild(d);
 }
}

/* ===== 精密引っ張り ===== */
function pickPullAdvanced(last,history){
 const avg=last.reduce((a,b)=>a+b)/last.length;
 let best=last[0],bestScore=-1;
 last.forEach(n=>{
  let s=0;
  s+=5-Math.min(Math.abs(n-avg),5);
  let g=0;for(let h of history){if(h.includes(n))break;g++}
  s+=Math.min(g,5);
  let f=0;history.forEach(h=>{if(h.includes(n))f++});
  if(f<=1)s+=2;
  if(n>=10&&n<=30)s+=1;
  if(s>bestScore){bestScore=s;best=n}
 });
 return best;
}

/* ===== プール ===== */
function buildPool(last,max,size,history){
 const pull=pickPullAdvanced(last,history);
 const ban=new Set(last.filter(n=>n!==pull));
 const p=[pull];
 for(let i=1;i<=max&&p.length<size;i++){
  if(!ban.has(i)&&!p.includes(i)) p.push(i);
 }
 return {pool:p.sort((a,b)=>a-b),pull};
}
function comb(a,k){
 const r=[];const f=(s,c)=>{
  if(c.length===k){r.push([...c]);return;}
  for(let i=s;i<a.length;i++){c.push(a[i]);f(i+1,c);c.pop();}
 };f(0,[]);return r;
}

/* ===== スコア ===== */
function score(t,last,history){
 let s=0;
 if(hasSeq(t))s+=5;
 if(t.filter(n=>last.includes(n)).length===1)s+=5;
 t.forEach(n=>{
  let g=0;for(let h of history){if(h.includes(n))break;g++}
  s+=Math.min(g,5);
 });
 return s;
}
function stars(s){if(s>=15)return 3;if(s>=11)return 2;return 1;}

/* ===== 描画 ===== */
function render(id,list,last,history){
 const root=document.getElementById(id);root.innerHTML="";
 list.forEach(o=>{
  if(!hasSeq(o)||o.filter(n=>last.includes(n)).length!==1)return;
  const sc=score(o,last,history);
  const st=stars(sc);
  const d=document.createElement("div");
  d.className="ticket";
  d.innerHTML=`
   <div class="stars star${st}">${"★".repeat(st)}</div>
   <div class="nums">${o.join(" ")}</div>
   <div class="tags">Score:${sc}</div>`;
  root.appendChild(d);
 });
}

/* ===== メイン ===== */
function calc(){
 const l6=read("l6",6,43);
 const m=read("mini",5,31);
 if(!l6||!m){alert("入力不足");return;}
 const h=parseHistory();

 const p6=buildPool(l6,43,7,h);
 const pm=buildPool(m,31,6,h);

 buildHeatmap(h,43,p6.pool);

 document.getElementById("pool6").textContent=p6.pool.join(" ");
 document.getElementById("meta6").textContent="固定："+p6.pull;
 document.getElementById("poolM").textContent=pm.pool.join(" ");
 document.getElementById("metaM").textContent="固定："+pm.pull;

 render("out6",comb(p6.pool,6),l6,h);
 render("outM",comb(pm.pool,5),m,h);

 judge();
}

function judge(){
 const a=document.querySelectorAll("#out6 .star3").length;
 const b=document.querySelectorAll("#outM .star3").length;
 const el=document.getElementById("battle");
 if(a>b) el.textContent="今日はロト6全力";
 else if(b>a) el.textContent="今日はミニロト厚め";
 else el.textContent="両方様子見";
}

function showStrong(){
 document.querySelectorAll(".ticket").forEach(t=>{
  if(!t.querySelector(".star3")) t.style.display="none";
 });
}
</script>
</body>
</html>
